<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <title>Register</title>
    
    <link rel="stylesheet" href="registrieren.css">

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body style="font-family: 'Montserrat';">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-logo" href="#"><img src="pics/logo.jpg"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto nav-fill w-100" style="font-size: large;">
        <li class="nav-item"><a class="nav-link" href="Start.html">Start</a></li>
        <li class="nav-item"><a class="nav-link" href="nonexistent.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="Findbefound.html">Find and be found</a></li>
        <li class="nav-item"><a class="nav-link" href="nonexistent.html">Community</a></li>
        <li class="nav-item"><a class="nav-link" href="nonexistent.html">Help</a></li>
        <li class="nav-item konto"><a href="login.html"><img src="pics/Avatar.png" class="loginpic"></a></li>
      </ul>
      
    </div>
</nav>
        
      <div class="container">
      
      <form action="" class="" >
        <div class="row" style="width: inherit;">
          <div class="col">
            <h1 style="text-align: center; margin: 6mm;">Welcome to travelbuddy!</h1>
          </div>
        </div>
        <div class="row pl-3 pr-3">
          <input type="text" name="email" id="email" class="form-control reginput" placeholder="Your E-Mail" required>         
        </div>
        <div class="row">
          <div class="col-lg-6 pl-3 pr-3">
            <input type="password" name="password" id="password" class="form-control reginput" style="margin-right: 5px" placeholder="Password (min. 8 characters)" required>  
          </div>
          <div class="col-lg-6 pl-3 pr-3">
            <input type="password" name="password" id="passwordconf" class="form-control reginput" placeholder="Confirm Password" required>  
          </div>              
        </div>
      </form>

          <button type="submit" class="submitreg" onClick="registrieren()">Register now</button>
          
    </div>
  </div>

    <!-- first Tether, then Bootstrap JS. -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  
    <script>
      function logconsole() {
        console.log("hallo")
      }
    </script>
  
    <script type="application/javascript">
      $(document).ready(function () {
          console.log("fertig geladen");
      });

      function registrieren () {
          var passw = document.getElementById("password").value;
          var passwconf = document.getElementById("passwordconf").value;
          var mail = document.getElementById("email").value;

          $(".falsch").removeClass("falsch");

          console.log(passw, passwconf, mail);

          if (passw != passwconf) {
            console.log("ungleich")
            $("#password").addClass("falsch");
            $("#passwordconf").addClass("falsch");
          }

          else if (mail == "") {
            console.log("leere Mail")
            $("#email").addClass("falsch");
          }

          else if (passw == "") {
            console.log("leeres passwort")
            $("#password").addClass("falsch");
            $("#passwordconf").addClass("falsch");
          }

          else if (passw.length < 8) {
            console.log("zu kurz fucker")
            $("#password").addClass("falsch");
            $("#passwordconf").addClass("falsch");
            alert('Dein Passwort ist zu kurz, bitte mindestens 8 Zeichen');
          }

          else {
            console.log(passw, passwconf, mail);
            pruefen(mail, passw, "");
            //window.location.href = 'Start.html';
          }
      }

      function test () {
          console.log("hi")
      }

      function pruefen(aMail, aPassw, schonda) {
        
        $.getJSON("https://webtechlecture.appspot.com/cloudstore/listkeys?owner=bjoernsreise",function(response)
						  {
              console.log(schonda,"schonda")
							$.each(response,function(index,keys)
							{
                console.log(keys, aMail)
                console.log(Boolean(keys['key'] === aMail), "mail gleich")
                //das eine ist ein json das andere ein string
                if (keys['key'] === aMail){
                    schonda = "true"
                    console.log("hast schon einen Account fucker")
                }
							});
              
              if (Boolean(schonda === "")){
                speichern(aMail, aPassw)
              }
              else {
                alert('Du hast schon eine Anmeldung!');
              }
              
							
							});
      }
      function speichern(aMail, aPassw) {
        
        console.log("hast noch keinen Account")
        var aJSONString = {"login":{"Email":aMail,"Passwort":aPassw}}
        $.getJSON("https://webtechlecture.appspot.com/cloudstore/add?owner=bjoernsreise"+
					  "&key="+aMail+"&jsonstring="+[encodeURIComponent(JSON.stringify(aJSONString))],
					  function(response)
					  {
						console.log(response);
            alert('Danke fÃ¼r Ihre Anmeldung!');
						
						
						});
      }
    </script>
</body style="font-family: 'Montserrat';">
</html>